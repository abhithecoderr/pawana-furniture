<!-- Set Detail Page -->
<!-- Set Detail Page -->

<section class="set-detail-section">
  <div class="set-detail-container">
    <!-- Breadcrumb -->
    <section class="breadcrumb-section">
      <div class="breadcrumb-container">
        <div class="page-breadcrumb">
          <a href="javascript:history.back()" class="breadcrumb-back" aria-label="Go back">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 12h18M3 12l6-6M3 12l6 6"/>
            </svg>
          </a>
          <a href="/">Home</a> /
          <a href="/room/<%= set.room.toLowerCase().replace(/ /g, '-') %>"><%= set.room %></a> /
          <span><%= set.name %></span>
        </div>
      </div>
    </section>

    <!-- Main Content - Side by Side -->
    <div class="set-content">

      <!-- Left: Image -->
      <div class="set-image-section">
        <div class="set-image-main">
          <img
            id="mainSetImage"
            src="<%= set.images && set.images.length > 0 ? set.images[0].url : '/images/placeholder.jpg' %>"
            alt="<%= set.name %>"
          />
        </div>

        <!-- Thumbnails Below Image -->
        <% if (set.images && set.images.length > 1) { %>
        <div class="set-thumbnails">
          <% set.images.forEach((image, index) => { %>
            <img
              src="<%= image.url %>"
              alt="<%= set.name %> - View <%= index + 1 %>"
              class="thumbnail <%= index === 0 ? 'active' : '' %>"
              onclick="changeMainImage('<%= image.url %>', this)"
            />
          <% }); %>
        </div>
        <% } %>
      </div>

      <!-- Right: Info -->
      <div class="set-info">
        <div class="set-header">
          <div class="set-title-row">
            <h1 class="set-title" id="setTitle"><%= set.name %></h1>
            <button
              class="wishlist-btn detail-wishlist"
              data-id="<%= set._id %>"
              data-type="set"
              data-name="<%= set.name %>"
              data-slug="<%= set.slug %>"
              data-image="<%= set.images && set.images.length > 0 ? set.images[0].url : '/images/placeholder.jpg' %>"
              onclick="handleWishlistClick(event, this)"
              aria-label="Add to wishlist">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
              </svg>
            </button>
          </div>
          <div class="set-meta">
            <span class="set-room"><%= set.room %></span>
            <span class="set-label">Set</span>
            <span class="set-style-badge <%= set.style.toLowerCase() %>" id="setStyleBadge"><%= set.style %></span>
          </div>
          <p class="set-code"><%= set.code %></p>
        </div>

        <% if (set.description) { %>
        <p class="set-description" id="setDescription"><%= set.description %></p>
        <% } %>

        <!-- Enquiry Button with WhatsApp -->
        <a href="https://wa.me/<%= contactSettings.whatsapp %>?text=Hi%2C%20I'm%20interested%20in%20<%= encodeURIComponent(set.name) %>%20(<%= set.code %>)"
           class="btn-primary enquiry-btn whatsapp-enquiry"
           target="_blank"
           rel="noopener noreferrer">
          <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
          </svg>
          Get an Enquiry
        </a>
      </div>
    </div>
  </div>
</section>


<!-- Related Sets Section -->
<!-- Similar Sets Carousel -->
<% if (similarSets && similarSets.length > 0) { %>
<section class="home-carousel">
  <div class="section-container">
    <div class="carousel-header">
      <h2 class="section-title">Similar Sets</h2>
    </div>
    <div class="carousel-wrapper">
      <div class="carousel-nav">
        <button class="carousel-arrow carousel-prev" data-carousel="similar-sets" aria-label="Previous set">‹</button>
        <button class="carousel-arrow carousel-next" data-carousel="similar-sets" aria-label="Next set">›</button>
      </div>
      <div class="carousel-container">
        <div class="carousel-track" id="similar-sets-carousel-track">
          <% similarSets.forEach(similarSet => { %>
          <div class="carousel-item active-category" data-category="similar-sets">
            <a href="/set/<%= similarSet.slug %>" class="set-card">
              <div class="set-card-badge">Set</div>
              <img src="<%= similarSet.images && similarSet.images.length > 0 ? similarSet.images[0].url : '/images/placeholder.jpg' %>" alt="<%= similarSet.name %>">
              <div class="card-name-row">
                <h3><%= similarSet.name %></h3>
              </div>
              <div class="set-card-meta">
                <span class="set-style-badge <%= similarSet.style.toLowerCase() %>"><%= similarSet.style %></span>
                <p><%= similarSet.room %> · <%= similarSet.code %></p>
              </div>
            </a>
          </div>
          <% }); %>
        </div>
      </div>
    </div>
  </div>
</section>
<% } %>

<!-- You May Also Like Section (Mixed Styles) -->
<% if (youMayAlsoLikeSets && youMayAlsoLikeSets.length > 0) { %>
<section class="related-items-section">
  <div class="related-items-container">
    <h2>You May Also Like</h2>
    <div class="product-grid">
      <% youMayAlsoLikeSets.forEach(otherSet => { %>
        <a href="/set/<%= otherSet.slug %>" class="set-card">
          <div class="set-card-badge">Set</div>
          <img
            src="<%= otherSet.images && otherSet.images.length > 0 ? otherSet.images[0].url : '/images/placeholder.jpg' %>"
            alt="<%= otherSet.name %>"
          />
          <div class="card-name-row">
            <h3><%= otherSet.name %></h3>
          </div>
          <div class="set-card-meta">
            <span class="set-style-badge <%= otherSet.style.toLowerCase() %>"><%= otherSet.style %></span>
            <p><%= otherSet.room %> · <%= otherSet.code %></p>
          </div>
        </a>
      <% }); %>
    </div>
  </div>
</section>
<% } %>

<script>
// Change main image from thumbnails
function changeMainImage(url, thumbnail) {
  document.getElementById('mainSetImage').src = url;
  document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
  thumbnail.classList.add('active');
}

// Enquiry form
function openEnquiryForm() {
  const setName = document.getElementById('setTitle').textContent;
  alert(`Enquiry form for ${setName} - This will be implemented with a modal or redirect to contact page`);
  // TODO: Implement enquiry modal or redirect
}

// Dynamic style toggle functionality
document.querySelectorAll('.style-toggle-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    // Parse set data
    const setData = JSON.parse(this.dataset.set);

    // Update active button
    document.querySelectorAll('.style-toggle-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');

    // Update main image
    if (setData.images && setData.images.length > 0) {
      document.getElementById('mainSetImage').src = setData.images[0].url;
    }

    // Update thumbnails
    const thumbnailsContainer = document.querySelector('.set-thumbnails');
    if (thumbnailsContainer && setData.images && setData.images.length > 1) {
      thumbnailsContainer.innerHTML = '';
      setData.images.forEach((image, index) => {
        const thumb = document.createElement('img');
        thumb.src = image.url;
        thumb.alt = `${setData.name} - View ${index + 1}`;
        thumb.className = `thumbnail ${index === 0 ? 'active' : ''}`;
        thumb.onclick = function() { changeMainImage(image.url, this); };
        thumbnailsContainer.appendChild(thumb);
      });
    } else if (thumbnailsContainer) {
      thumbnailsContainer.innerHTML = '';
    }

    // Update title
    document.getElementById('setTitle').textContent = setData.name;

    // Update items count
    document.getElementById('setItemsCount').textContent = `${setData.items ? setData.items.length : 0} Pieces`;

    // Update description
    const descElement = document.getElementById('setDescription');
    if (descElement) {
      descElement.textContent = setData.description;
    }

    // Update style badge
    const badge = document.getElementById('setStyleBadge');
    badge.textContent = setData.style;
    badge.className = `set-style-badge ${setData.style.toLowerCase()}`;

    // Update individual items grid
    const itemsGrid = document.getElementById('setItemsGrid');
    if (itemsGrid && setData.items && setData.items.length > 0) {
      itemsGrid.innerHTML = '';
      setData.items.forEach(item => {
        const card = document.createElement('a');
        card.href = `/item/${item.slug}`;
        card.className = 'set-item-card';
        card.innerHTML = `
          <div class="set-item-image">
            <img
              src="${item.images && item.images.length > 0 ? item.images[0].url : '/images/placeholder.jpg'}"
              alt="${item.name}"
            />
          </div>
          <div class="set-item-info">
            <h3>${item.name}</h3>
            <p class="set-item-type">${item.type}</p>
          </div>
        `;
        itemsGrid.appendChild(card);
      });
    }

    // Update URL without reload
    window.history.pushState({}, '', `/set/${setData.slug}`);
  });
});

</script>

